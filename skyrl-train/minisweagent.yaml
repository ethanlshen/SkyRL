version: v2
budget: ai2/oceo
description: skyrl mini sweagebt
tasks:
  - name:
    image:
      beaker: ai2/cuda12.8-ubuntu24.04-torch2.7.1
    envVars:
      - name: BEAKER_ALLOW_SUBCONTAINERS
        value: 1
      - name: ANTHROPIC_API_KEY
        secret: ethans_ANTHROPIC_API_KEY
      - name: WANDB_API_KEY
        secret: ethans_WANDB_API_KEY
      - name: MIRROR_URL
        value: "jupiter-cs-aus-108.reviz.ai2.in:5000,saturn-cs-aus-245.reviz.ai2.in:5000,neptune-cs-aus-263.reviz.ai2.in:5000"
    datasets:
      - mountPath: /weka/oe-adapt-default
        source:
          weka: oe-adapt-default
    command:
      [
        "bash",
        "-c",
        "setup_dockerio_mirror && cd /weka/oe-adapt-default/ethans/SkyRL/skyrl-train && source setup.sh && pip install --upgrade uv && uv run --isolated examples/mini_swe_agent/preprocess_swegym.py --output_dir /weka/oe-adapt-default/ethans/SkyRL/swe_gym_subset && bash examples/mini_swe_agent/run_mini_swe_8B.sh"
      ]
    constraints:
      cluster:
        - ai2/jupiter-cirrascale-2
        - ai2/ceres-cirrascale
    resources:
      gpuCount: 8
    context:
      priority: high
      preemptible: true